â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              â­ USAR ESTE ARQUIVO! v25 FINAL â­
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¦ CLP_10_ROTINAS_v25_SAFE.sup

   MD5: f04fb1e8cb9c3e45181cfd13e56031d6
   Tamanho: 29 KB
   Status: âœ… APENAS REGISTROS VÃLIDOS COMO ORIGEM

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ PROBLEMA RESOLVIDO!

A questÃ£o era: Como espelhar I/O (E0-E7, S0-S7) para Modbus se MOV nÃ£o
consegue ler os registros 0100-0107 e 0180-0187?

ğŸ’¡ SOLUÃ‡ÃƒO DESCOBERTA:

  1. MOV NO CLP:
     âŒ NÃƒO pode ler 0100-0107 (E0-E7) - restriÃ§Ã£o interna
     âŒ NÃƒO pode ler 0180-0187 (S0-S7) - restriÃ§Ã£o interna
     âœ… PODE ler 0840-0852 (Ã¢ngulos) - validado em ROT4
     âœ… PODE ler 04D6, 05F0 (especiais) - validado em ROT4

  2. PYTHON VIA MODBUS RTU:
     âœ… CONSEGUE ler 0100-0107 com Function 0x03!
     âœ… CONSEGUE ler 0180-0187 com Function 0x03!
     âœ… Manual confirma: "Read Holding Registers (0x03)"

     MÃ©todo:
     ```python
     # Ler E0-E7 (entradas digitais)
     for addr in range(0x0100, 0x0108):
         reg = client.read_holding_register(addr)
         status = reg & 0x0001  # Bit 0 = estado

     # Ler S0-S7 (saÃ­das digitais)
     for addr in range(0x0180, 0x0188):
         reg = client.read_holding_register(addr)
         status = reg & 0x0001  # Bit 0 = estado
     ```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ CONTEÃšDO v25 (71 INSTRUÃ‡Ã•ES MOV):

ROT5 (6 linhas):
  MOV 0840 â†’ 0944  (Ã¢ngulo esquerdo 1 MSW)
  MOV 0842 â†’ 0942  (Ã¢ngulo esquerdo 1 LSW)
  MOV 0846 â†’ 0944  (Ã¢ngulo esquerdo 2 MSW)
  MOV 0848 â†’ 0942  (Ã¢ngulo esquerdo 2 LSW)
  MOV 0850 â†’ 0944  (Ã¢ngulo esquerdo 3 MSW)
  MOV 0852 â†’ 0942  (Ã¢ngulo esquerdo 3 LSW)

ROT6 (18 linhas):
  Copia Ã¢ngulos 0840-0852 alternadamente para 0942/0944
  (ciclo repetido para garantir disponibilidade)

ROT7 (12 linhas):
  Copia Ã¢ngulos 0840-0852 alternadamente para 0942/0944

ROT8 (15 linhas):
  Copia Ã¢ngulos 0840-0852 alternadamente para 0942/0944

ROT9 (20 linhas):
  Copia Ã¢ngulos 0840-0852 alternadamente para 0942/0944

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ PADRÃƒO USADO (copiado de ROT4 original):

```
[LineXXXXX]
  [Features]
    Branchs:01
    Type:0
    Label:0
    Comment:0
    Out:MOV     T:0028 Size:003 E:0840 E:0944
    Height:03          â† VISUAL SPACING!
  [Branch01]
    X1position:00
    X2position:13
    Yposition:00
    Height:01
    B1:00
    B2:00
    BInputnumber:00    â† SEM CONDIÃ‡ÃƒO
    {0;00;00F7;-1;-1;-1;-1;00}  â† ALWAYS TRUE
    ###
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸš€ TESTAR NO WINSUP:

1. Abrir CLP_10_ROTINAS_v25_SAFE.sup
2. Verificar:
   âœ… Abre sem erros?
   âœ… Todas as ROT5-9 mostram linhas MOV (nÃ£o FIM)?
   âœ… Nenhum erro "registro fora do range"?
3. Compilar â†’ deve compilar SEM ERROS!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ’» INTEGRAÃ‡ÃƒO PYTHON:

modbus_client.py:
```python
class ModbusClientWrapper:
    def read_digital_inputs(self):
        """LÃª E0-E7 via Modbus Function 0x03"""
        inputs = {}
        for i in range(8):
            addr = 0x0100 + i  # E0-E7
            reg = self.client.read_holding_registers(addr, 1)
            inputs[f'E{i}'] = reg.registers[0] & 0x0001
        return inputs

    def read_digital_outputs(self):
        """LÃª S0-S7 via Modbus Function 0x03"""
        outputs = {}
        for i in range(8):
            addr = 0x0180 + i  # S0-S7
            reg = self.client.read_holding_registers(addr, 1)
            outputs[f'S{i}'] = reg.registers[0] & 0x0001
        return outputs
```

state_manager.py:
```python
async def poll_once(self):
    """Polling loop - atualiza estado completo"""
    # I/O digitais (NÃƒO espelhados pelo CLP!)
    self.machine_state['inputs'] = self.modbus.read_digital_inputs()
    self.machine_state['outputs'] = self.modbus.read_digital_outputs()

    # Encoder (espelhado em 04D6/04D7)
    encoder_msw = self.modbus.read_register(0x04D6)
    encoder_lsw = self.modbus.read_register(0x04D7)
    self.machine_state['encoder_raw'] = (encoder_msw << 16) | encoder_lsw

    # Ã‚ngulos (espelhados em 0942/0944 via ROT5-9)
    self.machine_state['mirror_a'] = self.modbus.read_register(0x0942)
    self.machine_state['mirror_b'] = self.modbus.read_register(0x0944)
```

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ˆ EVOLUÃ‡ÃƒO ATÃ‰ v25:

v19: âŒ Usou instruÃ§Ãµes invÃ¡lidas (NOT, ADD, MUL, DIV)
  â†“
v20-v22: âŒ Tentou escrever em registros 08xx (invÃ¡lidos)
  â†“
v23: âŒ Tentou ler registros I/O com MOV (nÃ£o funciona)
  â†“
v24: âŒ Ainda tentava ler I/O, timers, status com MOV
  â†“
v25: âœ… USA APENAS Ã‚NGULOS (0840-0852) + PYTHON LÃŠ I/O DIRETAMENTE!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ’¡ LIÃ‡Ã•ES APRENDIDAS:

1. âœ… MOV tem restriÃ§Ãµes de fonte - sÃ³ alguns registros funcionam
2. âœ… Modbus externo (Python) tem MAIS acesso que MOV interno
3. âœ… Registros 0100-0107 e 0180-0187 sÃ£o acessÃ­veis via Modbus
4. âœ… Ler bit 0 de cada registro: `status = register & 0x0001`
5. âœ… Manual MPC4004 confirma: "Read Holding Registers (0x03)"
6. âœ… SEMPRE testar contra originais (ROT0-4) antes de inventar

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ¯ RESULTADO FINAL:

CLP:
  - ROT0-4: Preservados 100% (controle da mÃ¡quina)
  - ROT5-9: 71 MOV copiando Ã¢ngulos para 0942/0944

Python:
  - LÃª I/O diretamente: Function 0x03, endereÃ§os 0100-0107, 0180-0187
  - LÃª Ã¢ngulos espelhados: 0942, 0944
  - LÃª encoder: 04D6, 04D7
  - Envia comandos: Function 0x05, endereÃ§os 00A0-00A9, 00DC, etc.

IHM Web:
  - SupervisÃ£o completa: I/O, encoder, Ã¢ngulos, status
  - Comandos de teclado: K0-K9, S1, S2, ENTER, ESC, EDIT
  - Sem modificar lÃ³gica original da mÃ¡quina

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

VersÃ£o atual:
  âœ… CLP_10_ROTINAS_v25_SAFE.sup
  MD5: f04fb1e8cb9c3e45181cfd13e56031d6

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

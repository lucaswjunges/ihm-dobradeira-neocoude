================================================================================
ESTRUTURA COMPLETA DO PROJETO IHM WEB - DOBRADEIRA NEOCOUDE-HD-15
================================================================================

ihm/
â”‚
â”œâ”€â”€ ğŸ“„ DOCUMENTAÃ‡ÃƒO
â”‚   â”œâ”€â”€ README.md              - InstruÃ§Ãµes completas de uso e troubleshooting
â”‚   â”œâ”€â”€ CLAUDE.md              - DocumentaÃ§Ã£o tÃ©cnica para Claude Code
â”‚   â”œâ”€â”€ QUICKSTART.md          - InÃ­cio rÃ¡pido (1 minuto)
â”‚   â”œâ”€â”€ CHECKLIST.md           - Checklist de validaÃ§Ã£o passo-a-passo
â”‚   â”œâ”€â”€ ESTRUTURA_PROJETO.txt  - Este arquivo (visÃ£o geral)
â”‚   â””â”€â”€ .gitignore             - Arquivos a ignorar no versionamento
â”‚
â”œâ”€â”€ ğŸ BACKEND PYTHON
â”‚   â”œâ”€â”€ modbus_map.py          - 95 registros/coils mapeados + helpers 32-bit
â”‚   â”œâ”€â”€ modbus_client.py       - Cliente Modbus (stub mode + live mode)
â”‚   â”œâ”€â”€ state_manager.py       - Polling asyncio 250ms + machine_state
â”‚   â”œâ”€â”€ main_server.py         - Servidor WebSocket + HTTP (ponto de entrada)
â”‚   â””â”€â”€ requirements.txt       - DependÃªncias Python (pymodbus, websockets, etc.)
â”‚
â”œâ”€â”€ ğŸŒ FRONTEND WEB
â”‚   â””â”€â”€ static/
â”‚       â””â”€â”€ index.html         - Interface web completa (HTML+CSS+JS vanilla)
â”‚                                â€¢ Display LCD virtual
â”‚                                â€¢ Teclado numÃ©rico K0-K9
â”‚                                â€¢ Teclas funÃ§Ã£o S1/S2/ENTER/ESC
â”‚                                â€¢ 3 campos Ã¢ngulos editÃ¡veis
â”‚                                â€¢ 5 LEDs indicadores
â”‚                                â€¢ WebSocket client
â”‚                                â€¢ Overlays erro (DESLIGADO/FALHA CLP)
â”‚
â””â”€â”€ ğŸ§ª TESTES
    â””â”€â”€ tests/
        â”œâ”€â”€ test_modbus.py     - Teste comunicaÃ§Ã£o completa (encoder, Ã¢ngulos, I/O)
        â”œâ”€â”€ test_angles.py     - Teste leitura/escrita Ã¢ngulos + conversÃµes
        â””â”€â”€ test_speed.py      - Teste mudanÃ§a velocidade (K1+K7)

================================================================================
ARQUITETURA DO SISTEMA
================================================================================

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          TABLET (Cliente)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ index.html (Navegador)                                             â”‚ â”‚
â”‚  â”‚  â€¢ Display encoder 45.7Â° (atualizaÃ§Ã£o 500ms)                       â”‚ â”‚
â”‚  â”‚  â€¢ Ã‚ngulos: [90.0Â°] [120.0Â°] [56.0Â°]                               â”‚ â”‚
â”‚  â”‚  â€¢ Teclado: [1][2][3][S1] [4][5][6][S2] ...                        â”‚ â”‚
â”‚  â”‚  â€¢ LEDs: â—â—â—‹â—‹â—‹ (dobra 1/2 ativas)                                  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–²â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ WebSocket (JSON)
                             â”‚ ws://192.168.x.x:8765
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               SERVIDOR (Ubuntu Notebook - Python 3)                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ main_server.py (asyncio event loop)                                â”‚ â”‚
â”‚  â”‚  â€¢ WebSocket server (8765) - comunica com tablet                   â”‚ â”‚
â”‚  â”‚  â€¢ HTTP server (8080) - serve index.html                           â”‚ â”‚
â”‚  â”‚  â€¢ Broadcast loop (500ms) - envia deltas para clientes             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚       â”‚                                              â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ state_manager.py        â”‚           â”‚ modbus_client.py           â”‚  â”‚
â”‚  â”‚  â€¢ poll_loop (250ms)    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â€¢ read_coil()             â”‚  â”‚
â”‚  â”‚  â€¢ machine_state {}     â”‚           â”‚  â€¢ read_register()         â”‚  â”‚
â”‚  â”‚    - encoder_angle      â”‚           â”‚  â€¢ read_32bit()            â”‚  â”‚
â”‚  â”‚    - bend_1/2/3_left    â”‚           â”‚  â€¢ write_coil()            â”‚  â”‚
â”‚  â”‚    - inputs/outputs     â”‚           â”‚  â€¢ press_key()             â”‚  â”‚
â”‚  â”‚    - leds, buttons      â”‚           â”‚  â€¢ change_speed_class()    â”‚  â”‚
â”‚  â”‚  â€¢ get_changes() deltas â”‚           â”‚  â€¢ stub_mode / live_mode   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                        â”‚
                                                        â”‚ Modbus RTU
                                                        â”‚ RS485-B
                                                        â”‚ 57600 bps
                                                        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CLP ATOS MPC4004 (Slave ID 1)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ REGISTROS MAPEADOS (95 total)                                    â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚ [ENCODER 32-bit]                                                 â”‚   â”‚
â”‚  â”‚  0x04D6/0x04D7 (1238/1239) â†’ PosiÃ§Ã£o angular 0-360Â°              â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚ [Ã‚NGULOS 32-bit]                                                 â”‚   â”‚
â”‚  â”‚  Dobra 1: 0x0840/0x0842 (2112/2114)                              â”‚   â”‚
â”‚  â”‚  Dobra 2: 0x0848/0x084A (2120/2122)                              â”‚   â”‚
â”‚  â”‚  Dobra 3: 0x0850/0x0852 (2128/2130)                              â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚ [BOTÃ•ES Coils]                                                   â”‚   â”‚
â”‚  â”‚  K0-K9: 0x00A9-0x00A0 (169-160)                                  â”‚   â”‚
â”‚  â”‚  S1/S2: 0x00DC/0x00DD (220/221)                                  â”‚   â”‚
â”‚  â”‚  ENTER/ESC/EDIT: 0x0025/0x00BC/0x0026                            â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚ [I/O DIGITAL Registers]                                          â”‚   â”‚
â”‚  â”‚  E0-E7: 0x0100-0x0107 (256-263) - Entradas                       â”‚   â”‚
â”‚  â”‚  S0-S7: 0x0180-0x0187 (384-391) - SaÃ­das                         â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚ [LEDs Coils]                                                     â”‚   â”‚
â”‚  â”‚  LED1-5: 0x00C0-0x00C4 (192-196)                                 â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚ [ESTADO CRÃTICO]                                                 â”‚   â”‚
â”‚  â”‚  0x00BE (190) = Modbus slave enable (DEVE estar ON!)             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

================================================================================
FLUXO DE DADOS
================================================================================

1. LEITURA (CLP â†’ Tablet)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   CLP â†’ Modbus RTU â†’ modbus_client.read_32bit(0x04D6, 0x04D7)
                   â†’ state_manager.poll_once() [250ms]
                   â†’ machine_state['encoder_angle'] = 45.7
                   â†’ main_server.broadcast_loop() [500ms]
                   â†’ WebSocket JSON: {"type": "state_update", "data": {...}}
                   â†’ index.html: encoderDisplay.textContent = "45.7Â°"

2. ESCRITA (Tablet â†’ CLP)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   index.html: button.click('K1')
            â†’ WebSocket: {"action": "press_key", "key": "K1"}
            â†’ main_server.handle_client_message()
            â†’ modbus_client.press_key(0x00A0, hold_ms=100)
            â†’ Modbus RTU: write_coil(0x00A0, True) â†’ wait 100ms â†’ write_coil(False)
            â†’ CLP detecta botÃ£o K1 pressionado

3. MODO STUB (Desenvolvimento SEM CLP)
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   modbus_client = ModbusClientWrapper(stub_mode=True)
                â†’ stub_registers = {0x04D6: 0x0000, 0x04D7: 0x01C9, ...}
                â†’ Simula encoder, Ã¢ngulos, I/O
                â†’ Interface funciona identicamente
                â†’ Desenvolve/testa sem hardware

================================================================================
COMANDOS RÃPIDOS
================================================================================

# Instalar
pip3 install -r requirements.txt

# Testar SEM CLP (modo stub)
python3 main_server.py --stub
# â†’ Abrir: http://localhost:8080

# Testar COM CLP (modo live)
python3 main_server.py --port /dev/ttyUSB0
# â†’ Abrir: http://localhost:8080

# Validar comunicaÃ§Ã£o Modbus
python3 tests/test_modbus.py

# Testar Ã¢ngulos
python3 tests/test_angles.py

# Testar velocidade
python3 tests/test_speed.py

================================================================================
MAPEAMENTO MODBUS RESUMIDO
================================================================================

FUNÃ‡ÃƒO       | ENDEREÃ‡O (Hex) | DECIMAL | DESCRIÃ‡ÃƒO
-------------|----------------|---------|----------------------------------
ENCODER MSW  | 0x04D6         | 1238    | PosiÃ§Ã£o angular (bits 31-16)
ENCODER LSW  | 0x04D7         | 1239    | PosiÃ§Ã£o angular (bits 15-0)
BEND 1 MSW   | 0x0842         | 2114    | Ã‚ngulo dobra 1 (bits 31-16)
BEND 1 LSW   | 0x0840         | 2112    | Ã‚ngulo dobra 1 (bits 15-0)
BEND 2 MSW   | 0x084A         | 2122    | Ã‚ngulo dobra 2 (bits 31-16)
BEND 2 LSW   | 0x0848         | 2120    | Ã‚ngulo dobra 2 (bits 15-0)
BEND 3 MSW   | 0x0852         | 2130    | Ã‚ngulo dobra 3 (bits 31-16)
BEND 3 LSW   | 0x0850         | 2128    | Ã‚ngulo dobra 3 (bits 15-0)
BTN K1       | 0x00A0         | 160     | BotÃ£o 1 (coil)
BTN S1       | 0x00DC         | 220     | FunÃ§Ã£o 1 (coil)
BTN ENTER    | 0x0025         | 37      | Confirmar (coil)
INPUT E0     | 0x0100         | 256     | Entrada digital 0 (register bit 0)
OUTPUT S0    | 0x0180         | 384     | SaÃ­da digital 0 (register bit 0)
LED 1        | 0x00C0         | 192     | LED 1 (coil)
MODBUS EN    | 0x00BE         | 190     | Modbus slave enable (CRÃTICO!)

ConversÃ£o 32-bit: value = (MSW << 16) | LSW
ConversÃ£o graus:  graus = value / 10.0

================================================================================
PRÃ“XIMOS PASSOS
================================================================================

1. Ler QUICKSTART.md
2. Instalar dependÃªncias: pip3 install -r requirements.txt
3. Testar modo stub: python3 main_server.py --stub
4. Testar comunicaÃ§Ã£o: python3 tests/test_modbus.py
5. Rodar servidor live: python3 main_server.py --port /dev/ttyUSB0
6. Abrir no tablet: http://<IP_NOTEBOOK>:8080
7. Validar com CHECKLIST.md

================================================================================
SUPORTE
================================================================================

DocumentaÃ§Ã£o TÃ©cnica: CLAUDE.md
InstruÃ§Ãµes UsuÃ¡rio:   README.md
InÃ­cio RÃ¡pido:        QUICKSTART.md
ValidaÃ§Ã£o:            CHECKLIST.md

Desenvolvido com Claude Code (Anthropic) - Novembro 2025
================================================================================

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IHM NEOCOUDE-HD-15 - PRODUCTION FINAL</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Share Tech Mono', 'Courier New', monospace;
            background: #1a1a1a;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }
        
        .ihm-panel {
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border: 4px solid #3a3a3a;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.8);
            max-width: 520px;
            width: 100%;
        }
        
        .ihm-header {
            text-align: center;
            color: #00ff00;
            font-size: 14px;
            margin-bottom: 15px;
            letter-spacing: 2px;
            font-weight: bold;
            border-bottom: 2px solid #00ff00;
            padding-bottom: 10px;
        }
        
        /* STATUS */
        .status-bar {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background: #0a0a0a;
            border-radius: 6px;
        }
        
        .status-item {
            text-align: center;
            font-size: 11px;
            color: #666;
        }
        
        .status-led {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #333;
            display: inline-block;
            margin-bottom: 4px;
        }
        
        .status-led.online {
            background: #00ff00;
            box-shadow: 0 0 10px #00ff00;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* LCD */
        .lcd-container {
            background: #0a0a0a;
            border: 3px solid #1a1a1a;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .lcd-display {
            background: linear-gradient(180deg, #9FBC2B 0%, #8FAC1F 100%);
            border: 2px solid #7A9920;
            border-radius: 3px;
            padding: 12px 10px;
            position: relative;
        }
        
        .lcd-line {
            font-size: 20px;
            font-weight: bold;
            color: #1a3a0a;
            letter-spacing: 3px;
            white-space: pre;
            line-height: 1.5;
            text-shadow: 0 1px 1px rgba(255,255,255,0.2);
        }
        
        /* SCREEN INFO */
        .screen-info {
            text-align: center;
            color: #00ff00;
            font-size: 12px;
            margin-bottom: 10px;
            padding: 8px;
            background: #0a0a0a;
            border-radius: 4px;
        }
        
        .help-text {
            text-align: center;
            color: #666;
            font-size: 9px;
            margin-bottom: 15px;
            line-height: 1.4;
        }
        
        /* BUTTONS */
        .btn-section {
            margin-bottom: 12px;
        }
        
        .btn-label {
            color: #00ff00;
            font-size: 10px;
            margin-bottom: 6px;
            text-align: center;
        }
        
        .btn-grid {
            display: grid;
            gap: 8px;
        }
        
        .grid-4 { grid-template-columns: repeat(4, 1fr); }
        .grid-7 { grid-template-columns: repeat(7, 1fr); }
        
        .btn {
            background: linear-gradient(145deg, #4a4a4a, #3a3a3a);
            border: 2px solid #555;
            border-radius: 6px;
            padding: 14px 8px;
            font-size: 14px;
            font-weight: bold;
            color: #ddd;
            cursor: pointer;
            transition: all 0.1s;
            user-select: none;
            box-shadow: 0 4px 0 #1a1a1a;
            text-align: center;
            position: relative;
        }
        
        .btn:active {
            transform: translateY(3px);
            box-shadow: 0 1px 0 #1a1a1a;
        }

        .btn.pressed {
            background: #00ff00 !important;
            color: #000 !important;
            border-color: #00cc00;
            transform: translateY(3px);
            box-shadow: 0 1px 0 #1a1a1a;
        }
        
        .btn-nav {
            background: linear-gradient(145deg, #4a8acc, #3a7abc);
            border-color: #2a6aac;
            color: #fff;
            font-size: 18px;
        }
        
        .btn-num {
            background: linear-gradient(145deg, #f4a742, #e89732);
            border-color: #d88722;
            color: #1a1a1a;
            font-size: 16px;
        }
        
        .btn-func {
            background: linear-gradient(145deg, #4a8acc, #3a7abc);
            border-color: #2a6aac;
            color: #fff;
        }
        
        .btn-enter {
            background: linear-gradient(145deg, #5cb85c, #4ca84c);
            border-color: #3c983c;
            color: #fff;
        }
        
        .btn-esc {
            background: linear-gradient(145deg, #d95c5c, #c94c4c);
            border-color: #b93c3c;
            color: #fff;
        }
        
        .btn-hint {
            font-size: 8px;
            color: rgba(255,255,255,0.5);
            margin-top: 2px;
            display: block;
        }
        
        /* FEEDBACK */
        .feedback {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #00ff00;
            color: #000;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: bold;
            display: none;
            z-index: 9999;
            box-shadow: 0 4px 10px rgba(0,255,0,0.5);
        }
        
        .feedback.show {
            display: block;
            animation: slideIn 0.3s;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
    </style>
</head>
<body>
    <div class="feedback" id="feedback"></div>
    
    <div class="ihm-panel">
        <div class="ihm-header">
            üîß NEOCOUDE-HD-15 - ATOS MPC4004
        </div>
        
        <div class="status-bar">
            <div class="status-item">
                <div class="status-led" id="wsLed"></div>
                <div id="wsStatus">WebSocket</div>
            </div>
            <div class="status-item">
                <div class="status-led" id="clpLed"></div>
                <div id="clpStatus">CLP</div>
            </div>
            <div class="status-item">
                <div class="status-led online"></div>
                <div>Sistema OK</div>
            </div>
        </div>
        
        <div class="lcd-container">
            <div class="lcd-display">
                <div class="lcd-line" id="line1">**TRILLOR MAQUINAS**</div>
                <div class="lcd-line" id="line2">**DOBRADEIRA HD    **</div>
            </div>
        </div>
        
        <div class="screen-info">
            üì∫ TELA <span id="screenNum">0</span>/10 - Use ‚Üë‚Üì para navegar
        </div>
        
        <div class="help-text">
            S1=Modo AUTO/MAN (Tela 2) | S2=Reset Encoder (Tela 3)<br>
            K1/K2/K3=Vai p/ Tela √Çngulo | K1+K7=Velocidade (Tela 7)
        </div>
        
        <!-- NAVEGA√á√ÉO -->
        <div class="btn-section">
            <div class="btn-label">NAVEGA√á√ÉO & FUN√á√ïES</div>
            <div class="btn-grid grid-4">
                <button class="btn btn-nav" onclick="nav(-1)" title="Tela anterior">‚Üë</button>
                <button class="btn btn-func" onclick="sendKey(220, event)" title="Modo AUTO/MAN (Tela 2)">
                    S1
                    <span class="btn-hint">Modo</span>
                </button>
                <button class="btn btn-func" onclick="sendKey(221, event)" title="Reset Encoder (Tela 3)">
                    S2
                    <span class="btn-hint">Reset</span>
                </button>
                <button class="btn btn-nav" onclick="nav(1)" title="Pr√≥xima tela">‚Üì</button>
            </div>
        </div>
        
        <!-- TECLADO NUM√âRICO -->
        <div class="btn-section">
            <div class="btn-label">TECLADO NUM√âRICO</div>
            <div class="btn-grid grid-7">
                <button class="btn btn-num" onclick="sendKey(160, event)" title="1 / Vai p/ √Çngulo 01">
                    K1
                    <span class="btn-hint">Ang1</span>
                </button>
                <button class="btn btn-num" onclick="sendKey(161, event)" title="2 / Vai p/ √Çngulo 02">
                    K2
                    <span class="btn-hint">Ang2</span>
                </button>
                <button class="btn btn-num" onclick="sendKey(162, event)" title="3 / Vai p/ √Çngulo 03">
                    K3
                    <span class="btn-hint">Ang3</span>
                </button>
                <button class="btn btn-num" onclick="sendKey(163, event)" title="4 / Sentido Esq (AUTO)">
                    K4
                    <span class="btn-hint">‚Üê</span>
                </button>
                <button class="btn btn-num" onclick="sendKey(164, event)" title="5 / Sentido Dir (AUTO)">
                    K5
                    <span class="btn-hint">‚Üí</span>
                </button>
                <button class="btn btn-num" onclick="sendKey(165, event)" title="6">K6</button>
                <button class="btn btn-num" onclick="sendKey(166, event)" title="7 / Velocidade c/ K1">
                    K7
                    <span class="btn-hint">Vel</span>
                </button>
            </div>
        </div>
        
        <div class="btn-section">
            <div class="btn-grid grid-7">
                <button class="btn btn-num" onclick="sendKey(167, event)" title="8">K8</button>
                <button class="btn btn-num" onclick="sendKey(168, event)" title="9">K9</button>
                <button class="btn btn-num" onclick="sendKey(169, event)" title="0">K0</button>
                <button class="btn btn-func" onclick="sendKey(241, event)" title="Travar/Destravar teclado">LOCK</button>
                <button class="btn btn-esc" onclick="sendKey(188, event)" title="Cancelar / Voltar">ESC</button>
                <button class="btn btn-func" onclick="sendKey(38, event)" title="Editar (Telas 4/5/6)">EDIT</button>
                <button class="btn btn-enter" onclick="sendKey(37, event)" title="Confirmar">ENTER</button>
            </div>
        </div>
    </div>
    
    <script>
        const WS_URL = 'ws://localhost:8086';
        let ws = null;
        let screen = 0;
        let data = { encoder: 0, connected: false };
        
        const screens = [
            ["**TRILLOR MAQUINAS**", "**DOBRADEIRA HD    **"],
            ["CAMARGO CORREIA CONS", "AQUISICAO AGOSTO- 06"],
            ["SELECAO DE AUTO/MAN ", "                    "],
            ["DESLOCAMENTO ANGULAR", () => `PV=${pad(data.encoder, 4)}¬∞ (${pad(data.encoder, 6)})`],
            ["AJUSTE DO ANGULO  01", "AJ=    ¬∞    PV=    ¬∞"],
            ["AJUSTE DO ANGULO  02", "AJ=    ¬∞    PV=    ¬∞"],
            ["AJUSTE DO ANGULO  03", "AJ=    ¬∞    PV=    ¬∞"],
            ["*SELECAO DA ROTACAO*", "                    "],
            ["CARENAGEM DOBRADEIRA", "                    "],
            ["TOTALIZADOR DE TEMPO", "*****     :  h *****"],
            ["ESTADO DA MAQUINA   ", "                    "]
        ];
        
        function pad(num, size) {
            return String(num).padStart(size, ' ');
        }
        
        function nav(dir) {
            screen = (screen + dir + screens.length) % screens.length;
            updateScreen();
            showFeedback(`Tela ${screen}`);
        }
        
        function updateScreen() {
            const s = screens[screen];
            document.getElementById('line1').textContent = typeof s[0] === 'function' ? s[0]() : s[0];
            document.getElementById('line2').textContent = typeof s[1] === 'function' ? s[1]() : s[1];
            document.getElementById('screenNum').textContent = screen;
        }
        
        function sendKey(code, event) {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(JSON.stringify({ action: 'press_key', key_code: code }));
                showFeedback(`‚úì Tecla ${code}`);

                // Feedback visual no bot√£o
                if (event && event.target) {
                    const btn = event.target.closest('.btn');
                    if (btn) {
                        btn.classList.add('pressed');
                        setTimeout(() => btn.classList.remove('pressed'), 150);
                    }
                }
            } else {
                showFeedback('‚ö†Ô∏è WebSocket OFF!');
            }
        }
        
        function showFeedback(msg) {
            const fb = document.getElementById('feedback');
            fb.textContent = msg;
            fb.classList.add('show');
            setTimeout(() => fb.classList.remove('show'), 1200);
        }
        
        function connect() {
            ws = new WebSocket(WS_URL);
            
            ws.onopen = () => {
                document.getElementById('wsLed').classList.add('online');
                document.getElementById('wsStatus').textContent = 'Online';
                showFeedback('‚úì Conectado');
            };
            
            ws.onmessage = (e) => {
                const msg = JSON.parse(e.data);
                if (msg.data) {
                    data = msg.data;
                    if (data.connected) {
                        document.getElementById('clpLed').classList.add('online');
                        document.getElementById('clpStatus').textContent = 'Online';
                    }
                    updateScreen();
                }
            };
            
            ws.onclose = () => {
                document.getElementById('wsLed').classList.remove('online');
                document.getElementById('wsStatus').textContent = 'Offline';
                setTimeout(connect, 2000);
            };
        }
        
        // Suporte teclado
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowUp') { e.preventDefault(); nav(-1); }
            if (e.key === 'ArrowDown') { e.preventDefault(); nav(1); }
            if (e.key === 'Enter') { e.preventDefault(); sendKey(37, null); }
            if (e.key === 'Escape') { e.preventDefault(); sendKey(188, null); }
            const nums = {'1':160,'2':161,'3':162,'4':163,'5':164,'6':165,'7':166,'8':167,'9':168,'0':169};
            if (nums[e.key]) { e.preventDefault(); sendKey(nums[e.key], null); }
        });
        
        connect();
        updateScreen();
        setInterval(updateScreen, 500);  // Atualiza encoder a cada 500ms
    </script>
</body>
</html>
